<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tower Defense</title>
  <style>
    body {
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    canvas {
      background: #222;
      border: 2px solid #555;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    class Enemy {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.size = 20;
            this.color = 'gray';
            this.speed = 0.5;
            this.health = 3;
        }
        update() {
            this.x += this.speed;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.size, this.size);
        }
    }

    class Tower {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.size = 20;
            this.color = 'gold';
            this.fireRate = 90;
            this.timer = 0;
        }
        update() {
            this.timer++;
            if (this.timer >= this.fireRate) {
                this.timer = 0;
                const target = enemies.find(e => this.inRange(e));
                if (target) {
                    bullets.push(new Bullet(this.x + this.size/2, this.y + this.size/2, target));
                }
            }
        }
        inRange(enemy) {
            const dx = this.x - enemy.x;
            const dy = this.y - enemy.y;
            return Math.sqrt(dx*dx + dy*dy) < 150;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x + this.size/2, this.y + this.size/2, this.size/2, 0, Math.PI*2);
            ctx.fill();
        }
    }

    class Bullet {
        constructor(x, y, target) {
            this.x = x;
            this.y = y;
            this.radius = 4;
            this.speed = 2.5;
            this.target = target;
        }
        update() {
            const dx = this.target.x + 10 - this.x;
            const dy = this.target.y + 10 - this.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            this.x += (dx / dist) * this.speed;
            this.y += (dy / dist) * this.speed;
            if (dist < this.radius + 10) {
                this.target.health -= 1;
                return true;
            }
            return false;
        }
        draw() {
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
            ctx.fill();
        }
    }

    const towers = [];
    const bullets = [];
    const enemies = [new Enemy(0, 200)];

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        towers.push(new Tower(x - 10, y - 10));
        console.log('Placed tower at', x, y);
    });

    function update() {
        enemies.forEach(e => e.update());
        towers.forEach(t => t.update());
        bullets.forEach((b, i) => {
            if (b.update()) bullets.splice(i, 1);
        });
        for (let i = enemies.length - 1; i >= 0; i--) {
            if (enemies[i].health <= 0) enemies.splice(i, 1);
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        enemies.forEach(e => e.draw());
        towers.forEach(t => t.draw());
        bullets.forEach(b => b.draw());
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>

